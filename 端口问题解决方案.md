# 🔧 Timee API 请求失败：端口问题完整解决方案

## 📋 问题总结

**问题现象：** 用户点击创建活动时出现 "API request failed: 400" 错误

**根本原因：** 用户通过错误的端口访问应用，导致API请求无法路由到后端

## 🎯 正确的访问方式

### 外部访问（推荐）
```
https://wmxkwzbmhflj.sealoshzh.site
```

### 内部访问（仅限开发环境）
```
http://localhost:8080  ✅ 正确 - 通过代理服务器
http://localhost:5173  ❌ 错误 - 直接访问前端，无API路由
http://localhost:3000  ❌ 错误 - 仅供内部API调用
```

## 🏗️ 系统架构说明

```
用户访问
    ↓
代理服务器 (8080端口)
    ├── /api/* → 后端API (3000端口)
    └── /*     → 前端应用 (5173端口)
```

## ✅ 立即修复方案

### 方案1：使用正确的外部地址（推荐）
直接访问：**https://wmxkwzbmhflj.sealoshzh.site**

### 方案2：如果在本地开发环境
访问：**http://localhost:8080**

## 🧪 验证修复结果

使用我创建的诊断工具验证：
```bash
# 在项目根目录下打开诊断工具
open port-diagnosis.html
# 或访问 http://localhost:8080/port-diagnosis.html
```

### 手动验证步骤

1. **验证API健康状态：**
```bash
curl -s https://wmxkwzbmhflj.sealoshzh.site/api/health
```

2. **测试创建活动API：**
```bash
curl -X POST https://wmxkwzbmhflj.sealoshzh.site/api/events/frontend \
  -H "Content-Type: application/json" \
  -d '{
    "id": "tc-123456",
    "title": "测试活动",
    "description": "测试描述", 
    "startDate": "2024-01-01",
    "endDate": "2024-01-02",
    "timezone": "UTC+8",
    "eventType": "group",
    "includeTime": true
  }'
```

## 📊 各端口状态

| 端口 | 服务 | 状态 | 可访问性 | 说明 |
|-----|------|-----|----------|------|
| 8080 | 代理服务器 | ✅ 运行中 | ✅ 推荐访问 | 统一入口，路由所有请求 |
| 5173 | 前端应用 | ✅ 运行中 | ❌ 避免直接访问 | 缺少API路由，会导致400错误 |
| 3000 | 后端API | ✅ 运行中 | ❌ 仅供内部 | 不接受直接外部访问 |

## 🔍 错误原因详解

### 为什么直接访问5173端口会失败？

1. **前端API配置：**
   ```javascript
   // timee-frontend/apps/web/src/services/apiService.ts
   const BASE_URL = '/api';  // 相对路径，需要代理
   ```

2. **代理配置：**
   ```javascript
   // proxy-server.js (8080端口)
   app.use('/api', createProxyMiddleware('http://localhost:3000'));
   ```

3. **问题链条：**
   ```
   用户访问5173端口 → 前端发送 /api/events 请求 → 5173端口无API路由 → 404/400错误
   ```

## 🚀 最终解决方案

### 立即行动：
1. **关闭所有当前标签页**
2. **访问正确地址：** https://wmxkwzbmhflj.sealoshzh.site
3. **测试创建活动功能**

### 开发环境使用：
1. **访问：** http://localhost:8080
2. **使用诊断工具验证**

## 📝 注意事项

- ✅ 始终通过代理端口（8080）或外部域名访问
- ❌ 避免直接访问前端端口（5173）
- 🔒 后端端口（3000）仅供内部服务通信
- 📱 外部域名支持HTTPS和移动端访问

## 🔧 开发者备注

如需修改端口配置，请确保：
1. 更新 `proxy-server.js` 中的路由配置
2. 更新前端的 `VITE_API_BASE_URL` 环境变量
3. 重启所有服务并验证连接性

---

**状态：** 🎉 问题已识别并提供完整解决方案
**下一步：** 使用正确地址访问应用并验证功能正常 