<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” Timee API é”™è¯¯å®æ—¶è°ƒè¯•å·¥å…·</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px;
            background-color: #f5f5f5;
            line-height: 1.6;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-weight: bold;
            border-left: 4px solid;
        }
        .success { 
            background-color: #d4edda; 
            color: #155724; 
            border-color: #28a745; 
        }
        .error { 
            background-color: #f8d7da; 
            color: #721c24; 
            border-color: #dc3545; 
        }
        .warning { 
            background-color: #fff3cd; 
            color: #856404; 
            border-color: #ffc107; 
        }
        .info { 
            background-color: #d1ecf1; 
            color: #0c5460; 
            border-color: #17a2b8; 
        }
        .btn {
            background-color: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin: 8px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .btn:hover { 
            background-color: #0056b3; 
            transform: translateY(-1px);
        }
        .btn:active { 
            transform: translateY(0);
        }
        .btn-danger {
            background-color: #dc3545;
        }
        .btn-danger:hover {
            background-color: #c82333;
        }
        .btn-success {
            background-color: #28a745;
        }
        .btn-success:hover {
            background-color: #218838;
        }
        .code-block {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            position: relative;
        }
        .section {
            margin: 30px 0;
            padding: 25px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background-color: #fafafa;
        }
        h1 { 
            color: #333; 
            text-align: center; 
            margin-bottom: 30px;
        }
        h2 { 
            color: #444; 
            border-bottom: 2px solid #007bff; 
            padding-bottom: 10px; 
            margin-top: 30px;
        }
        h3 { 
            color: #666; 
            margin-top: 25px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .log-container {
            background-color: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            line-height: 1.4;
        }
        .log-entry {
            margin: 2px 0;
            padding: 2px 0;
        }
        .log-success { color: #68d391; }
        .log-error { color: #f56565; }
        .log-warning { color: #ffa726; }
        .log-info { color: #4299e1; }
        .input-group {
            margin: 15px 0;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        .input-group input, .input-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .timeline {
            position: relative;
            padding-left: 30px;
        }
        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #ddd;
        }
        .timeline-item {
            position: relative;
            margin: 20px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -22px;
            top: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #007bff;
            border: 2px solid white;
        }
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #6c757d;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        .copy-btn:hover {
            background: #5a6268;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Timee API é”™è¯¯å®æ—¶è°ƒè¯•å·¥å…·</h1>
        
        <div class="section">
            <h2>ğŸ“Š å½“å‰çŠ¶æ€æ£€æµ‹</h2>
            <div class="grid">
                <div class="card">
                    <h3>ğŸŒ è®¿é—®çŠ¶æ€</h3>
                    <div id="accessStatus">æ£€æµ‹ä¸­...</div>
                    <button class="btn" onclick="detectAccessStatus()">é‡æ–°æ£€æµ‹</button>
                </div>
                <div class="card">
                    <h3>ğŸ”— API è¿æ¥</h3>
                    <div id="apiStatus">æ£€æµ‹ä¸­...</div>
                    <button class="btn" onclick="testAPIConnection()">æµ‹è¯•è¿æ¥</button>
                </div>
                <div class="card">
                    <h3>ğŸ¯ åˆ›å»ºæ´»åŠ¨æµ‹è¯•</h3>
                    <div id="createEventStatus">å‡†å¤‡å°±ç»ª</div>
                    <button class="btn" onclick="testCreateEvent()">æµ‹è¯•åˆ›å»º</button>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ§ª æ‰‹åŠ¨æµ‹è¯•åˆ›å»ºæ´»åŠ¨</h2>
            <div class="grid">
                <div class="card">
                    <h3>ğŸ“ æ´»åŠ¨ä¿¡æ¯</h3>
                    <div class="input-group">
                        <label for="testTitle">æ´»åŠ¨æ ‡é¢˜</label>
                        <input type="text" id="testTitle" value="æµ‹è¯•æ´»åŠ¨" placeholder="è¾“å…¥æ´»åŠ¨æ ‡é¢˜">
                    </div>
                    <div class="input-group">
                        <label for="testDescription">æ´»åŠ¨æè¿°</label>
                        <input type="text" id="testDescription" value="APIè°ƒè¯•æµ‹è¯•" placeholder="è¾“å…¥æ´»åŠ¨æè¿°">
                    </div>
                    <div class="input-group">
                        <label for="testTCode">T-Code (å¯é€‰)</label>
                        <input type="text" id="testTCode" placeholder="ç•™ç©ºè‡ªåŠ¨ç”Ÿæˆ" maxlength="9">
                    </div>
                    <button class="btn btn-success" onclick="manualCreateEvent()">ğŸš€ åˆ›å»ºæ´»åŠ¨</button>
                    <button class="btn" onclick="generateTestTCode()">ğŸ² ç”Ÿæˆæµ‹è¯•ä»£ç </button>
                </div>
                <div class="card">
                    <h3>ğŸ“‹ è¯·æ±‚è¯¦æƒ…</h3>
                    <div id="requestDetails">
                        <div class="code-block">
                            <div class="copy-btn" onclick="copyRequestDetails()">å¤åˆ¶</div>
                            <pre id="requestDetailsContent">å‡†å¤‡å‘é€è¯·æ±‚...</pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ“ˆ è°ƒè¯•æ—¶é—´çº¿</h2>
            <div class="timeline" id="debugTimeline">
                <div class="timeline-item">
                    <strong>è°ƒè¯•å·¥å…·å·²å¯åŠ¨</strong>
                    <div>å‡†å¤‡å¼€å§‹è¯Šæ–­ API é”™è¯¯...</div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ” è¯¦ç»†æ—¥å¿—</h2>
            <div style="text-align: right; margin-bottom: 10px;">
                <button class="btn btn-danger" onclick="clearLogs()">æ¸…é™¤æ—¥å¿—</button>
                <button class="btn" onclick="exportLogs()">å¯¼å‡ºæ—¥å¿—</button>
            </div>
            <div class="log-container" id="logContainer">
                <div class="log-entry log-info">[å¯åŠ¨] è°ƒè¯•å·¥å…·å·²åŠ è½½</div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ“ é—®é¢˜æŠ¥å‘Š</h2>
            <div id="problemReport">
                <div class="info">
                    <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong>
                    <ol>
                        <li>ç‚¹å‡»"é‡æ–°æ£€æµ‹"ç¡®è®¤å½“å‰è®¿é—®çŠ¶æ€</li>
                        <li>ç‚¹å‡»"æµ‹è¯•è¿æ¥"éªŒè¯APIè¿æ¥</li>
                        <li>ç‚¹å‡»"æµ‹è¯•åˆ›å»º"æ¨¡æ‹Ÿåˆ›å»ºæ´»åŠ¨</li>
                        <li>æŸ¥çœ‹è¯¦ç»†æ—¥å¿—äº†è§£å…·ä½“é”™è¯¯ä¿¡æ¯</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <script>
        let logs = [];
        let timelineItems = [];

        // æ·»åŠ æ—¥å¿—
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            logs.push({ message: logEntry, type, timestamp: Date.now() });
            
            const logContainer = document.getElementById('logContainer');
            const logDiv = document.createElement('div');
            logDiv.className = `log-entry log-${type}`;
            logDiv.textContent = logEntry;
            logContainer.appendChild(logDiv);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // æ·»åŠ æ—¶é—´çº¿é¡¹ç›®
        function addTimelineItem(title, description, status = 'info') {
            const timeline = document.getElementById('debugTimeline');
            const item = document.createElement('div');
            item.className = 'timeline-item';
            item.innerHTML = `
                <strong>${title}</strong>
                <div>${description}</div>
                <small style="color: #666;">${new Date().toLocaleTimeString()}</small>
            `;
            timeline.appendChild(item);
            timeline.scrollTop = timeline.scrollHeight;
        }

        // æ£€æµ‹è®¿é—®çŠ¶æ€
        function detectAccessStatus() {
            const url = window.location.href;
            const port = window.location.port || (window.location.protocol === 'https:' ? '443' : '80');
            const protocol = window.location.protocol;
            
            addLog(`å½“å‰è®¿é—®åœ°å€: ${url}`, 'info');
            addLog(`æ£€æµ‹åˆ°ç«¯å£: ${port}`, 'info');
            
            const statusDiv = document.getElementById('accessStatus');
            let statusHTML = '';
            
            if (port === '8080') {
                statusHTML = '<div class="status success">âœ… æ­£ç¡®ï¼é€šè¿‡ä»£ç†ç«¯å£è®¿é—®</div>';
                addLog('âœ… ç«¯å£æ£€æµ‹é€šè¿‡ - ä½¿ç”¨ä»£ç†ç«¯å£8080', 'success');
                addTimelineItem('ç«¯å£æ£€æµ‹', 'ä½¿ç”¨æ­£ç¡®çš„ä»£ç†ç«¯å£8080', 'success');
            } else if (port === '5173') {
                statusHTML = '<div class="status error">âŒ é”™è¯¯ï¼ç›´æ¥è®¿é—®å‰ç«¯ç«¯å£</div>';
                statusHTML += '<div class="warning">è¿™ä¼šå¯¼è‡´APIè¯·æ±‚å¤±è´¥ã€‚è¯·è®¿é—® <a href="' + url.replace(':5173', ':8080') + '" target="_blank">æ­£ç¡®åœ°å€</a></div>';
                addLog('âŒ ç«¯å£æ£€æµ‹å¤±è´¥ - ç›´æ¥è®¿é—®å‰ç«¯ç«¯å£5173', 'error');
                addTimelineItem('ç«¯å£æ£€æµ‹', 'å‘ç°é—®é¢˜ï¼šç›´æ¥è®¿é—®å‰ç«¯ç«¯å£5173', 'error');
            } else if (protocol === 'https:') {
                statusHTML = '<div class="status success">âœ… é€šè¿‡HTTPSå¤–éƒ¨åŸŸåè®¿é—®</div>';
                addLog('âœ… ç«¯å£æ£€æµ‹é€šè¿‡ - ä½¿ç”¨HTTPSå¤–éƒ¨åŸŸå', 'success');
                addTimelineItem('ç«¯å£æ£€æµ‹', 'ä½¿ç”¨HTTPSå¤–éƒ¨åŸŸåè®¿é—®', 'success');
            } else {
                statusHTML = '<div class="status warning">âš ï¸ æœªçŸ¥ç«¯å£é…ç½®</div>';
                addLog(`âš ï¸ æ£€æµ‹åˆ°æœªçŸ¥ç«¯å£: ${port}`, 'warning');
                addTimelineItem('ç«¯å£æ£€æµ‹', `æ£€æµ‹åˆ°æœªçŸ¥ç«¯å£: ${port}`, 'warning');
            }
            
            statusDiv.innerHTML = statusHTML;
        }

        // æµ‹è¯•APIè¿æ¥
        async function testAPIConnection() {
            addLog('ğŸ”„ å¼€å§‹æµ‹è¯•APIè¿æ¥...', 'info');
            addTimelineItem('APIè¿æ¥æµ‹è¯•', 'å¼€å§‹æµ‹è¯•å¥åº·æ£€æŸ¥ç«¯ç‚¹...');
            
            const statusDiv = document.getElementById('apiStatus');
            statusDiv.innerHTML = '<div class="status info">æ­£åœ¨æµ‹è¯•...</div>';
            
            try {
                const response = await fetch('/api/health');
                const data = await response.json();
                
                if (response.ok) {
                    statusDiv.innerHTML = '<div class="status success">âœ… APIè¿æ¥æ­£å¸¸</div>';
                    addLog('âœ… APIå¥åº·æ£€æŸ¥æˆåŠŸ', 'success');
                    addLog(`APIå“åº”: ${JSON.stringify(data)}`, 'info');
                    addTimelineItem('APIè¿æ¥æµ‹è¯•', 'APIå¥åº·æ£€æŸ¥æˆåŠŸ', 'success');
                } else {
                    statusDiv.innerHTML = `<div class="status error">âŒ APIè¿æ¥å¤±è´¥ (${response.status})</div>`;
                    addLog(`âŒ APIå¥åº·æ£€æŸ¥å¤±è´¥: HTTP ${response.status}`, 'error');
                    addTimelineItem('APIè¿æ¥æµ‹è¯•', `APIå¥åº·æ£€æŸ¥å¤±è´¥: HTTP ${response.status}`, 'error');
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">âŒ APIè¿æ¥å¤±è´¥: ${error.message}</div>`;
                addLog(`âŒ APIè¿æ¥é”™è¯¯: ${error.message}`, 'error');
                addTimelineItem('APIè¿æ¥æµ‹è¯•', `è¿æ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•åˆ›å»ºæ´»åŠ¨
        async function testCreateEvent() {
            addLog('ğŸ¯ å¼€å§‹æµ‹è¯•åˆ›å»ºæ´»åŠ¨...', 'info');
            addTimelineItem('åˆ›å»ºæ´»åŠ¨æµ‹è¯•', 'å¼€å§‹æ¨¡æ‹Ÿåˆ›å»ºæ´»åŠ¨...');
            
            const statusDiv = document.getElementById('createEventStatus');
            statusDiv.innerHTML = '<div class="status info">æ­£åœ¨æµ‹è¯•...</div>';
            
            // ç”Ÿæˆæµ‹è¯•æ•°æ®
            const testData = generateTestEventData();
            
            addLog(`æµ‹è¯•æ•°æ®: ${JSON.stringify(testData, null, 2)}`, 'info');
            
            try {
                const response = await fetch('/api/events/frontend', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });
                
                addLog(`å“åº”çŠ¶æ€: ${response.status} ${response.statusText}`, 'info');
                
                if (response.ok) {
                    const result = await response.json();
                    statusDiv.innerHTML = '<div class="status success">âœ… åˆ›å»ºæ´»åŠ¨æˆåŠŸï¼</div>';
                    addLog('âœ… åˆ›å»ºæ´»åŠ¨æˆåŠŸ', 'success');
                    addLog(`åˆ›å»ºç»“æœ: ${JSON.stringify(result, null, 2)}`, 'success');
                    addTimelineItem('åˆ›å»ºæ´»åŠ¨æµ‹è¯•', 'åˆ›å»ºæ´»åŠ¨æˆåŠŸï¼', 'success');
                } else {
                    const errorText = await response.text();
                    statusDiv.innerHTML = `<div class="status error">âŒ åˆ›å»ºæ´»åŠ¨å¤±è´¥ (${response.status})</div>`;
                    addLog(`âŒ åˆ›å»ºæ´»åŠ¨å¤±è´¥: HTTP ${response.status}`, 'error');
                    addLog(`é”™è¯¯è¯¦æƒ…: ${errorText}`, 'error');
                    addTimelineItem('åˆ›å»ºæ´»åŠ¨æµ‹è¯•', `åˆ›å»ºå¤±è´¥: HTTP ${response.status}`, 'error');
                    
                    // å°è¯•è§£æé”™è¯¯ä¿¡æ¯
                    try {
                        const errorData = JSON.parse(errorText);
                        if (errorData.message) {
                            addLog(`æœåŠ¡å™¨é”™è¯¯ä¿¡æ¯: ${errorData.message}`, 'error');
                        }
                    } catch (e) {
                        addLog('æ— æ³•è§£æé”™è¯¯å“åº”', 'warning');
                    }
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">âŒ åˆ›å»ºæ´»åŠ¨å¤±è´¥: ${error.message}</div>`;
                addLog(`âŒ åˆ›å»ºæ´»åŠ¨é”™è¯¯: ${error.message}`, 'error');
                addTimelineItem('åˆ›å»ºæ´»åŠ¨æµ‹è¯•', `ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
            }
        }

        // ç”Ÿæˆæµ‹è¯•äº‹ä»¶æ•°æ®
        function generateTestEventData() {
            const timestamp = Date.now().toString().slice(-6);
            return {
                id: `tc-${timestamp}`,
                title: 'è°ƒè¯•æµ‹è¯•æ´»åŠ¨',
                description: 'å®æ—¶è°ƒè¯•å·¥å…·æµ‹è¯•',
                startDate: '2024-01-01',
                endDate: '2024-01-02',
                timezone: 'UTC+8',
                eventType: 'group',
                includeTime: true
            };
        }

        // æ‰‹åŠ¨åˆ›å»ºæ´»åŠ¨
        async function manualCreateEvent() {
            const title = document.getElementById('testTitle').value.trim();
            const description = document.getElementById('testDescription').value.trim();
            const tcode = document.getElementById('testTCode').value.trim();
            
            if (!title) {
                addLog('âŒ è¯·è¾“å…¥æ´»åŠ¨æ ‡é¢˜', 'error');
                return;
            }
            
            const eventData = {
                id: tcode || `tc-${Date.now().toString().slice(-6)}`,
                title: title,
                description: description,
                startDate: '2024-01-01',
                endDate: '2024-01-02',
                timezone: 'UTC+8',
                eventType: 'group',
                includeTime: true
            };
            
            // æ›´æ–°è¯·æ±‚è¯¦æƒ…
            document.getElementById('requestDetailsContent').textContent = JSON.stringify(eventData, null, 2);
            
            addLog(`ğŸ”„ æ‰‹åŠ¨åˆ›å»ºæ´»åŠ¨: ${title}`, 'info');
            addTimelineItem('æ‰‹åŠ¨åˆ›å»ºæ´»åŠ¨', `æ ‡é¢˜: ${title}, T-Code: ${eventData.id}`);
            
            try {
                const response = await fetch('/api/events/frontend', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(eventData)
                });
                
                addLog(`å“åº”çŠ¶æ€: ${response.status} ${response.statusText}`, 'info');
                
                if (response.ok) {
                    const result = await response.json();
                    addLog('âœ… æ‰‹åŠ¨åˆ›å»ºæ´»åŠ¨æˆåŠŸ', 'success');
                    addLog(`åˆ›å»ºç»“æœ: ${JSON.stringify(result, null, 2)}`, 'success');
                    addTimelineItem('æ‰‹åŠ¨åˆ›å»ºæ´»åŠ¨', 'åˆ›å»ºæˆåŠŸï¼', 'success');
                    
                    // æ˜¾ç¤ºæˆåŠŸä¿¡æ¯
                    const reportDiv = document.getElementById('problemReport');
                    reportDiv.innerHTML = `
                        <div class="status success">
                            <strong>ğŸ‰ åˆ›å»ºæˆåŠŸï¼</strong><br>
                            æ´»åŠ¨ID: ${result.data.id}<br>
                            T-Code: ${result.data.tcCode}<br>
                            <a href="/event/${result.data.tcCode}" target="_blank">æŸ¥çœ‹æ´»åŠ¨</a>
                        </div>
                    `;
                } else {
                    const errorText = await response.text();
                    addLog(`âŒ æ‰‹åŠ¨åˆ›å»ºæ´»åŠ¨å¤±è´¥: HTTP ${response.status}`, 'error');
                    addLog(`é”™è¯¯è¯¦æƒ…: ${errorText}`, 'error');
                    addTimelineItem('æ‰‹åŠ¨åˆ›å»ºæ´»åŠ¨', `åˆ›å»ºå¤±è´¥: HTTP ${response.status}`, 'error');
                    
                    // æ˜¾ç¤ºé”™è¯¯åˆ†æ
                    analyzeError(response.status, errorText);
                }
            } catch (error) {
                addLog(`âŒ æ‰‹åŠ¨åˆ›å»ºæ´»åŠ¨é”™è¯¯: ${error.message}`, 'error');
                addTimelineItem('æ‰‹åŠ¨åˆ›å»ºæ´»åŠ¨', `ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
                analyzeError(0, error.message);
            }
        }

        // é”™è¯¯åˆ†æ
        function analyzeError(status, errorText) {
            const reportDiv = document.getElementById('problemReport');
            let analysis = '';
            
            if (status === 400) {
                analysis = `
                    <div class="status error">
                        <strong>âŒ 400 é”™è¯¯åˆ†æ</strong><br>
                        è¿™é€šå¸¸æ˜¯è¯·æ±‚æ•°æ®æ ¼å¼é—®é¢˜ï¼š<br>
                        â€¢ æ£€æŸ¥T-Codeæ ¼å¼æ˜¯å¦æ­£ç¡®<br>
                        â€¢ ç¡®è®¤å¿…å¡«å­—æ®µæ˜¯å¦å®Œæ•´<br>
                        â€¢ éªŒè¯æ—¥æœŸæ ¼å¼æ˜¯å¦æ­£ç¡®<br>
                        <br>
                        <strong>æœåŠ¡å™¨å“åº”:</strong><br>
                        <div class="code-block">${errorText}</div>
                    </div>
                `;
            } else if (status === 409) {
                analysis = `
                    <div class="status warning">
                        <strong>âš ï¸ 409 å†²çªé”™è¯¯</strong><br>
                        T-Codeå·²å­˜åœ¨ï¼Œè¯·å°è¯•ï¼š<br>
                        â€¢ ä½¿ç”¨ä¸åŒçš„T-Code<br>
                        â€¢ ç‚¹å‡»"ç”Ÿæˆæµ‹è¯•ä»£ç "è·å–æ–°ä»£ç <br>
                    </div>
                `;
            } else if (status === 0) {
                analysis = `
                    <div class="status error">
                        <strong>âŒ ç½‘ç»œè¿æ¥é”™è¯¯</strong><br>
                        å¯èƒ½çš„åŸå› ï¼š<br>
                        â€¢ ç«¯å£è®¿é—®é”™è¯¯<br>
                        â€¢ ç½‘ç»œè¿æ¥é—®é¢˜<br>
                        â€¢ æœåŠ¡å™¨æœªå“åº”<br>
                        <br>
                        <strong>å»ºè®®:</strong><br>
                        ç¡®è®¤ä½¿ç”¨æ­£ç¡®çš„è®¿é—®åœ°å€
                    </div>
                `;
            } else {
                analysis = `
                    <div class="status error">
                        <strong>âŒ HTTP ${status} é”™è¯¯</strong><br>
                        <div class="code-block">${errorText}</div>
                    </div>
                `;
            }
            
            reportDiv.innerHTML = analysis;
        }

        // ç”Ÿæˆæµ‹è¯•T-Code
        function generateTestTCode() {
            const timestamp = Date.now().toString().slice(-6);
            document.getElementById('testTCode').value = `tc-${timestamp}`;
            addLog(`ç”Ÿæˆæµ‹è¯•T-Code: tc-${timestamp}`, 'info');
        }

        // å¤åˆ¶è¯·æ±‚è¯¦æƒ…
        function copyRequestDetails() {
            const content = document.getElementById('requestDetailsContent').textContent;
            navigator.clipboard.writeText(content).then(() => {
                addLog('âœ… è¯·æ±‚è¯¦æƒ…å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
            }).catch(err => {
                addLog('âŒ å¤åˆ¶å¤±è´¥', 'error');
            });
        }

        // æ¸…é™¤æ—¥å¿—
        function clearLogs() {
            logs = [];
            document.getElementById('logContainer').innerHTML = '<div class="log-entry log-info">[æ¸…é™¤] æ—¥å¿—å·²æ¸…é™¤</div>';
            addLog('æ—¥å¿—å·²æ¸…é™¤', 'info');
        }

        // å¯¼å‡ºæ—¥å¿—
        function exportLogs() {
            const logText = logs.map(log => log.message).join('\n');
            const blob = new Blob([logText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `timee-debug-logs-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            addLog('âœ… æ—¥å¿—å·²å¯¼å‡º', 'success');
        }

        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ
        window.onload = function() {
            addLog('ğŸš€ å®æ—¶è°ƒè¯•å·¥å…·å·²å¯åŠ¨', 'info');
            detectAccessStatus();
            testAPIConnection();
            
            // è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•T-Code
            generateTestTCode();
            
            addTimelineItem('å·¥å…·å¯åŠ¨', 'æ‰€æœ‰åŠŸèƒ½å·²å°±ç»ªï¼Œå¼€å§‹è¯Šæ–­...');
        };
    </script>
</body>
</html> 