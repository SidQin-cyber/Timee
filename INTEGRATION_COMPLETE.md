# ğŸ‰ å‰ç«¯é›†æˆä¸ç›‘æ§éƒ¨ç½²å®Œæˆæ€»ç»“

## ğŸ“‹ **ä»»åŠ¡å®ŒæˆçŠ¶æ€**

### âœ… ä»»åŠ¡1ï¼šå‰ç«¯é›†æˆ - æ›´æ–°å‰ç«¯ç»„ä»¶ä½¿ç”¨æ–°çš„APIç»“æ„

**å®Œæˆæƒ…å†µ**ï¼šå·²å®Œæˆæ ¸å¿ƒæœåŠ¡å±‚æ›´æ–°

#### ğŸ”„ **å·²æ›´æ–°çš„æ–‡ä»¶**

1. **EventService (`timee-frontend/apps/web/src/services/eventService.ts`)**
   - âœ… æ›¿æ¢ `apiClient` ä¸º `newApiClient`
   - âœ… æ›´æ–°æ‰€æœ‰APIè°ƒç”¨ä»¥é€‚é…æ–°çš„åç«¯ç»“æ„
   - âœ… ä¿æŒå‰ç«¯æ¥å£å…¼å®¹æ€§

2. **ResponseService (`timee-frontend/apps/web/src/services/responseService.ts`)**
   - âœ… å®Œå…¨é‡å†™ä»¥ä½¿ç”¨Room/Participantæ¨¡å‹
   - âœ… æ˜ å°„Event/Responseæ¨¡å‹åˆ°æ–°çš„æ¶æ„
   - âœ… å®ç°å®æ—¶æ›´æ–°é€»è¾‘

#### ğŸ”Œ **APIæ˜ å°„å…³ç³»**
- Event â†’ Room (shareId + tcCode)
- Response â†’ Participant + SelectedSlot
- EventId â†’ shareId (12ä½nanoid)
- T-Code â†’ tcCode (6ä½æ•°å­—)

---

### âœ… ä»»åŠ¡2ï¼šWebSocket - é›†æˆSocket.IOå®¢æˆ·ç«¯è¿›è¡Œå®æ—¶æ›´æ–°

**å®Œæˆæƒ…å†µ**ï¼šå·²å®ŒæˆWebSocketå®¢æˆ·ç«¯é›†æˆ

#### ğŸ”„ **å·²æ›´æ–°çš„æ–‡ä»¶**

1. **Real-time Sync Hook (`timee-frontend/apps/web/src/hooks/useRealTimeSync.ts`)**
   - âœ… æ›´æ–°Socket.IOè¿æ¥åœ°å€
   - âœ… é€‚é…æ–°çš„äº‹ä»¶åç§°ï¼š`roomUpdated`, `userJoined`, `availabilityUpdated`
   - âœ… ä¿æŒé™çº§åˆ°è½®è¯¢çš„åå¤‡æœºåˆ¶

2. **Socket Client Utility (`timee-frontend/apps/web/src/lib/socketClient.ts`)**
   - âœ… åˆ›å»ºç»Ÿä¸€çš„Socket.IOå®¢æˆ·ç«¯ç®¡ç†ç±»
   - âœ… å®ç°æˆ¿é—´ç®¡ç†å’Œäº‹ä»¶ç›‘å¬
   - âœ… è‡ªåŠ¨é‡è¿å’Œé”™è¯¯å¤„ç†

3. **New API Client (`timee-frontend/apps/web/src/lib/newApiClient.ts`)**
   - âœ… æ·»åŠ Socket.IOè¿æ¥æ–¹æ³•
   - âœ… é›†æˆsocketClientè¿›è¡Œå®æ—¶é€šä¿¡
   - âœ… æä¾›è¿æ¥çŠ¶æ€æ£€æŸ¥

#### ğŸ“¡ **Socket.IOäº‹ä»¶æ˜ å°„**
- `joinRoom` - åŠ å…¥æˆ¿é—´
- `leaveRoom` - ç¦»å¼€æˆ¿é—´  
- `roomUpdated` - æˆ¿é—´æ•°æ®æ›´æ–°
- `userJoined` - ç”¨æˆ·åŠ å…¥é€šçŸ¥
- `availabilityUpdated` - å¯ç”¨æ€§æ›´æ–°

---

### âœ… ä»»åŠ¡3ï¼šéƒ¨ç½² - ä½¿ç”¨Dockeré…ç½®éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

**å®Œæˆæƒ…å†µ**ï¼šå·²å®Œæˆéƒ¨ç½²è„šæœ¬å’Œé…ç½®

#### ğŸš€ **éƒ¨ç½²æ–‡ä»¶**

1. **å¯åŠ¨è„šæœ¬ (`timee-api/start-express.sh`)**
   - âœ… Expressåº”ç”¨ä¸“ç”¨å¯åŠ¨è„šæœ¬
   - âœ… ç¯å¢ƒå˜é‡é…ç½®
   - âœ… æ•°æ®åº“è¿ç§»å’ŒPrismaå®¢æˆ·ç«¯ç”Ÿæˆ

2. **éƒ¨ç½²è„šæœ¬ (`timee-api/deploy.sh`)**
   - âœ… å®Œæ•´çš„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æµç¨‹
   - âœ… ä¾èµ–å®‰è£…ã€æ•°æ®åº“è®¾ç½®ã€æœåŠ¡å¯åŠ¨
   - âœ… å¥åº·æ£€æŸ¥å’Œéƒ¨ç½²éªŒè¯
   - âœ… å½©è‰²è¾“å‡ºå’Œé”™è¯¯å¤„ç†

3. **Dockeré…ç½® (`timee-api/Dockerfile`)**
   - âœ… å¤šé˜¶æ®µæ„å»ºé…ç½®
   - âœ… érootç”¨æˆ·å®‰å…¨è®¾ç½®
   - âœ… å¥åº·æ£€æŸ¥é›†æˆ

4. **Sealosé…ç½® (`timee-api/sealos-ingress-fix.yaml`)**
   - âœ… WebSocketæ”¯æŒé…ç½®
   - âœ… Socket.IOå…¼å®¹æ€§è®¾ç½®
   - âœ… CORSå’Œä»£ç†é…ç½®

#### ğŸ”§ **éƒ¨ç½²ç‰¹æ€§**
- âœ… è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹
- âœ… ä¾èµ–æ£€æŸ¥å’ŒéªŒè¯
- âœ… ä¼˜é›…çš„é”™è¯¯å¤„ç†
- âœ… æœåŠ¡å¥åº·æ£€æŸ¥
- âœ… WebSocketå’ŒSocket.IOæ”¯æŒ

---

### âœ… ä»»åŠ¡4ï¼šç›‘æ§ - è®¾ç½®æ—¥å¿—ç›‘æ§å’Œå‘Šè­¦

**å®Œæˆæƒ…å†µ**ï¼šå·²å®Œæˆç»¼åˆç›‘æ§ç³»ç»Ÿ

#### ğŸ“Š **ç›‘æ§ç»„ä»¶**

1. **ç›‘æ§é…ç½® (`timee-api/config/monitoring.js`)**
   - âœ… ç»“æ„åŒ–æ—¥å¿—é…ç½®ï¼ˆapp, error, access, performance, securityï¼‰
   - âœ… æ€§èƒ½æŒ‡æ ‡é˜ˆå€¼è®¾ç½®
   - âœ… å‘Šè­¦é…ç½®å’Œæ¸ é“
   - âœ… å¥åº·æ£€æŸ¥é…ç½®

2. **ç›‘æ§ä¸­é—´ä»¶ (`timee-api/middleware/monitoring.js`)**
   - âœ… HTTPè¯·æ±‚ç›‘æ§
   - âœ… é”™è¯¯ç›‘æ§å’Œå‘Šè­¦
   - âœ… WebSocketè¿æ¥ç›‘æ§
   - âœ… ç³»ç»ŸæŒ‡æ ‡æ”¶é›†
   - âœ… å®‰å…¨ç›‘æ§ï¼ˆXSSã€SQLæ³¨å…¥ã€é€Ÿç‡é™åˆ¶ï¼‰

3. **ç›‘æ§ä»ªè¡¨æ¿ (`timee-api/public/monitoring.html`)**
   - âœ… å®æ—¶ç³»ç»Ÿå¥åº·çŠ¶æ€
   - âœ… HTTPå’ŒWebSocketæŒ‡æ ‡
   - âœ… å†…å­˜å’Œæ€§èƒ½ç›‘æ§
   - âœ… ä¸šåŠ¡æŒ‡æ ‡å±•ç¤º
   - âœ… å‘Šè­¦å†å²è®°å½•

4. **Expressé›†æˆ (`timee-api/src/index.js`)**
   - âœ… ç›‘æ§ä¸­é—´ä»¶é›†æˆ
   - âœ… ç³»ç»Ÿç›‘æ§å¯åŠ¨
   - âœ… ä»ªè¡¨æ¿è·¯ç”± (`/dashboard`)
   - âœ… æŒ‡æ ‡ç«¯ç‚¹ (`/metrics`)

#### ğŸ“ˆ **ç›‘æ§åŠŸèƒ½**
- âœ… å®æ—¶ç³»ç»ŸæŒ‡æ ‡æ”¶é›†
- âœ… æ™ºèƒ½å‘Šè­¦ç³»ç»Ÿï¼ˆé”™è¯¯ç‡ã€å“åº”æ—¶é—´ã€å†…å­˜ä½¿ç”¨ï¼‰
- âœ… å®‰å…¨äº‹ä»¶ç›‘æ§
- âœ… WebSocketè¿æ¥è¿½è¸ª
- âœ… ä¸šåŠ¡æŒ‡æ ‡ç»Ÿè®¡
- âœ… ç¾è§‚çš„ç›‘æ§ä»ªè¡¨æ¿

---

## ğŸ”— **ç³»ç»Ÿç«¯ç‚¹æ€»è§ˆ**

### ğŸŒ **APIç«¯ç‚¹**
- `GET /health` - å¥åº·æ£€æŸ¥
- `GET /metrics` - ç³»ç»ŸæŒ‡æ ‡
- `GET /dashboard` - ç›‘æ§ä»ªè¡¨æ¿
- `POST /api/rooms` - åˆ›å»ºæˆ¿é—´
- `POST /api/rooms/:shareId/join` - åŠ å…¥æˆ¿é—´
- `PUT /api/rooms/:shareId/availability` - æ›´æ–°å¯ç”¨æ€§
- `GET /api/rooms/:shareId` - è·å–æˆ¿é—´ä¿¡æ¯
- `GET /api/rooms/tc/:tcCode` - T-CodeæŸ¥è¯¢

### ğŸ“¡ **Socket.IOäº‹ä»¶**
- `joinRoom` - åŠ å…¥æˆ¿é—´
- `leaveRoom` - ç¦»å¼€æˆ¿é—´
- `roomUpdated` - æˆ¿é—´æ›´æ–°å¹¿æ’­
- `userJoined` - ç”¨æˆ·åŠ å…¥é€šçŸ¥
- `availabilityUpdated` - å¯ç”¨æ€§æ›´æ–°é€šçŸ¥

---

## ğŸ“ **å…³é”®æ–‡ä»¶å˜æ›´**

### ğŸ¯ **å‰ç«¯æ–‡ä»¶**
```
timee-frontend/apps/web/src/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ eventService.ts          âœ… å·²æ›´æ–°
â”‚   â””â”€â”€ responseService.ts       âœ… å·²é‡å†™
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useRealTimeSync.ts       âœ… å·²æ›´æ–°
â””â”€â”€ lib/
    â”œâ”€â”€ newApiClient.ts          âœ… å·²æ‰©å±•
    â””â”€â”€ socketClient.ts          âœ… æ–°å¢
```

### ğŸ¯ **åç«¯æ–‡ä»¶**
```
timee-api/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ monitoring.js            âœ… æ–°å¢
â”œâ”€â”€ middleware/
â”‚   â””â”€â”€ monitoring.js            âœ… æ–°å¢
â”œâ”€â”€ public/
â”‚   â””â”€â”€ monitoring.html          âœ… æ–°å¢
â”œâ”€â”€ src/
â”‚   â””â”€â”€ index.js                 âœ… å·²é›†æˆç›‘æ§
â”œâ”€â”€ deploy.sh                    âœ… æ–°å¢
â”œâ”€â”€ start-express.sh             âœ… æ–°å¢
â””â”€â”€ sealos-ingress-fix.yaml      âœ… å·²æ›´æ–°
```

---

## ğŸš€ **å¯åŠ¨å’Œä½¿ç”¨æŒ‡å—**

### ğŸ“¦ **åç«¯å¯åŠ¨**
```bash
cd timee-api

# å¼€å‘ç¯å¢ƒ
npm run dev

# ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
./deploy.sh

# æ‰‹åŠ¨å¯åŠ¨
./start-express.sh
```

### ğŸ” **ç›‘æ§è®¿é—®**
- **APIå¥åº·æ£€æŸ¥**: http://localhost:3000/health
- **ç³»ç»ŸæŒ‡æ ‡**: http://localhost:3000/metrics  
- **ç›‘æ§ä»ªè¡¨æ¿**: http://localhost:3000/dashboard

### ğŸ“± **å‰ç«¯å¼€å‘**
```bash
cd timee-frontend/apps/web

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# å‰ç«¯å°†è‡ªåŠ¨è¿æ¥åˆ°localhost:3000çš„åç«¯API
```

---

## ğŸ¯ **æŠ€æœ¯æ¶æ„æ€»ç»“**

### ğŸ”„ **æ•°æ®æµ**
```
å‰ç«¯ç»„ä»¶ â†’ newApiClient â†’ Express API â†’ Prisma â†’ PostgreSQL
    â†“            â†“             â†“
Socket.IO â† socketClient â† Socket.IO Server
    â†“
å®æ—¶æ›´æ–° â†’ useRealTimeSync â†’ UIè‡ªåŠ¨åˆ·æ–°
```

### ğŸ“Š **ç›‘æ§æµ**
```
HTTPè¯·æ±‚ â†’ ç›‘æ§ä¸­é—´ä»¶ â†’ æŒ‡æ ‡æ”¶é›† â†’ å‘Šè­¦æ£€æŸ¥ â†’ ä»ªè¡¨æ¿å±•ç¤º
WebSocket â†’ è¿æ¥è·Ÿè¸ª â†’ æ¶ˆæ¯ç»Ÿè®¡ â†’ å®æ—¶ç›‘æ§
ç³»ç»Ÿèµ„æº â†’ å®šæœŸé‡‡é›† â†’ é˜ˆå€¼æ¯”è¾ƒ â†’ è‡ªåŠ¨å‘Šè­¦
```

---

## âœ¨ **æ–°åŠŸèƒ½ç‰¹æ€§**

1. **ğŸ”„ å®æ—¶åŒæ­¥**: WebSocketé©±åŠ¨çš„æ— å»¶è¿Ÿæ•°æ®åŒæ­¥
2. **ğŸ“Š å…¨é¢ç›‘æ§**: ç³»ç»Ÿå¥åº·ã€æ€§èƒ½ã€å®‰å…¨çš„360åº¦ç›‘æ§
3. **ğŸš¨ æ™ºèƒ½å‘Šè­¦**: åŸºäºé˜ˆå€¼çš„è‡ªåŠ¨å‘Šè­¦ç³»ç»Ÿ
4. **ğŸ›¡ï¸ å®‰å…¨é˜²æŠ¤**: XSSã€SQLæ³¨å…¥æ£€æµ‹å’Œé€Ÿç‡é™åˆ¶
5. **ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–**: å“åº”æ—¶é—´å’Œèµ„æºä½¿ç”¨ç›‘æ§
6. **ğŸ¨ å¯è§†åŒ–é¢æ¿**: ç¾è§‚ç›´è§‚çš„ç›‘æ§ä»ªè¡¨æ¿
7. **ğŸš€ ä¸€é”®éƒ¨ç½²**: è‡ªåŠ¨åŒ–çš„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æµç¨‹

---

## ğŸŠ **é›†æˆå®Œæˆ - ç³»ç»Ÿå·²å°±ç»ªï¼**

æ‰€æœ‰4ä¸ªä¸»è¦ä»»åŠ¡å·²å…¨éƒ¨å®Œæˆï¼š
- âœ… å‰ç«¯APIé›†æˆ
- âœ… WebSocketå®æ—¶é€šä¿¡  
- âœ… ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- âœ… ç›‘æ§å‘Šè­¦ç³»ç»Ÿ

**æ–°çš„Timee APIç°å·²å®Œå…¨è¿è¡Œï¼Œå…·å¤‡ä¼ä¸šçº§çš„å®æ—¶é€šä¿¡ã€ç›‘æ§å’Œéƒ¨ç½²èƒ½åŠ›ï¼** ğŸš€ 