<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®æ—¶åŒæ­¥æµ‹è¯• - Timee</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
        }
        .test-section.success {
            border-color: #10b981;
            background: #f0fdf4;
        }
        .test-section.error {
            border-color: #ef4444;
            background: #fef2f2;
        }
        .test-section.warning {
            border-color: #f59e0b;
            background: #fffbeb;
        }
        .test-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #1f2937;
        }
        .test-description {
            color: #6b7280;
            margin-bottom: 15px;
        }
        .test-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .test-button:hover {
            background: #2563eb;
        }
        .test-button.success {
            background: #10b981;
        }
        .test-button.error {
            background: #ef4444;
        }
        .test-result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            background: #f9fafb;
            border-left: 4px solid #3b82f6;
            font-family: monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background: #10b981; }
        .status-error { background: #ef4444; }
        .status-warning { background: #f59e0b; }
        .status-info { background: #3b82f6; }
        .instructions {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .instructions h3 {
            color: #0369a1;
            margin-top: 0;
        }
        .event-link {
            background: #f3f4f6;
            padding: 10px;
            border-radius: 6px;
            font-family: monospace;
            margin: 10px 0;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”„ å®æ—¶åŒæ­¥åŠŸèƒ½æµ‹è¯•</h1>
            <p>æµ‹è¯•ç”¨æˆ·é€‰æ‹©æ—¶é—´çš„å®æ—¶åŒæ­¥å’Œæ•°æ®æ¢å¤åŠŸèƒ½</p>
        </div>

        <div class="instructions">
            <h3>ğŸ“‹ æµ‹è¯•è¯´æ˜</h3>
            <p><strong>ç›®æ ‡ï¼š</strong>éªŒè¯ä»¥ä¸‹ä¸¤ä¸ªå…³é”®é—®é¢˜æ˜¯å¦å·²ä¿®å¤ï¼š</p>
            <ol>
                <li><strong>å®æ—¶åŒæ­¥é—®é¢˜ï¼š</strong>ç”¨æˆ·åœ¨æˆ¿é—´å†…å‹¾é€‰æ—¶é—´æ—¶ï¼Œå³ä¾§å›¢é˜Ÿçƒ­åŠ›å›¾åº”è¯¥ç«‹å³æ˜¾ç¤ºå˜åŒ–</li>
                <li><strong>æ•°æ®æ¢å¤é—®é¢˜ï¼š</strong>ç”¨æˆ·é‡æ–°è¿›å…¥æˆ¿é—´æ—¶ï¼Œå·¦ä¾§é€‰æ‹©çŠ¶æ€åº”è¯¥æ­£ç¡®æ¢å¤ï¼Œå³ä¾§çƒ­åŠ›å›¾åº”è¯¥ä¿æŒä¸€è‡´</li>
            </ol>
            <p><strong>æµ‹è¯•æ–¹æ³•ï¼š</strong>ä½¿ç”¨ä¸åŒçš„æµè§ˆå™¨çª—å£æˆ–è®¾å¤‡æ¨¡æ‹Ÿå¤šç”¨æˆ·åœºæ™¯</p>
        </div>

        <!-- æµ‹è¯•äº‹ä»¶é“¾æ¥ -->
        <div class="test-section">
            <div class="test-title">
                <span class="status-indicator status-info"></span>
                æµ‹è¯•äº‹ä»¶é“¾æ¥
            </div>
            <div class="test-description">
                ä½¿ç”¨ä»¥ä¸‹äº‹ä»¶è¿›è¡Œæµ‹è¯•ï¼Œæˆ–è€…åˆ›å»ºæ–°çš„æµ‹è¯•äº‹ä»¶
            </div>
            <div class="event-link" id="testEventLink">
                http://localhost:8080/event/tc-realtime-test
            </div>
            <button class="test-button" onclick="createTestEvent()">åˆ›å»ºæ–°æµ‹è¯•äº‹ä»¶</button>
            <button class="test-button" onclick="openTestEvent()">æ‰“å¼€æµ‹è¯•äº‹ä»¶</button>
            <div class="test-result" id="eventResult" style="display: none;"></div>
        </div>

        <!-- å®æ—¶åŒæ­¥æµ‹è¯• -->
        <div class="test-section" id="realtimeSyncTest">
            <div class="test-title">
                <span class="status-indicator status-warning"></span>
                å®æ—¶åŒæ­¥æµ‹è¯•
            </div>
            <div class="test-description">
                æµ‹è¯•ç”¨æˆ·é€‰æ‹©æ—¶é—´æ—¶ï¼Œå³ä¾§çƒ­åŠ›å›¾æ˜¯å¦ç«‹å³æ›´æ–°
            </div>
            <button class="test-button" onclick="testRealtimeSync()">å¼€å§‹å®æ—¶åŒæ­¥æµ‹è¯•</button>
            <button class="test-button" onclick="simulateUserSelection()">æ¨¡æ‹Ÿç”¨æˆ·é€‰æ‹©</button>
            <div class="test-result" id="realtimeSyncResult" style="display: none;"></div>
        </div>

        <!-- æ•°æ®æ¢å¤æµ‹è¯• -->
        <div class="test-section" id="dataRecoveryTest">
            <div class="test-title">
                <span class="status-indicator status-warning"></span>
                æ•°æ®æ¢å¤æµ‹è¯•
            </div>
            <div class="test-description">
                æµ‹è¯•ç”¨æˆ·é‡æ–°è¿›å…¥æˆ¿é—´æ—¶ï¼Œé€‰æ‹©çŠ¶æ€æ˜¯å¦æ­£ç¡®æ¢å¤
            </div>
            <button class="test-button" onclick="testDataRecovery()">å¼€å§‹æ•°æ®æ¢å¤æµ‹è¯•</button>
            <button class="test-button" onclick="simulatePageReload()">æ¨¡æ‹Ÿé¡µé¢é‡æ–°åŠ è½½</button>
            <div class="test-result" id="dataRecoveryResult" style="display: none;"></div>
        </div>

        <!-- å¤šç”¨æˆ·åŒæ­¥æµ‹è¯• -->
        <div class="test-section" id="multiUserTest">
            <div class="test-title">
                <span class="status-indicator status-warning"></span>
                å¤šç”¨æˆ·åŒæ­¥æµ‹è¯•
            </div>
            <div class="test-description">
                æµ‹è¯•å¤šä¸ªç”¨æˆ·åŒæ—¶é€‰æ‹©æ—¶é—´æ—¶çš„åŒæ­¥æ•ˆæœ
            </div>
            <button class="test-button" onclick="testMultiUserSync()">å¼€å§‹å¤šç”¨æˆ·æµ‹è¯•</button>
            <button class="test-button" onclick="openMultipleWindows()">æ‰“å¼€å¤šä¸ªæµ‹è¯•çª—å£</button>
            <div class="test-result" id="multiUserResult" style="display: none;"></div>
        </div>

        <!-- ç³»ç»ŸçŠ¶æ€æ£€æŸ¥ -->
        <div class="test-section" id="systemStatusTest">
            <div class="test-title">
                <span class="status-indicator status-info"></span>
                ç³»ç»ŸçŠ¶æ€æ£€æŸ¥
            </div>
            <div class="test-description">
                æ£€æŸ¥å‰ç«¯å’Œåç«¯æœåŠ¡çš„è¿è¡ŒçŠ¶æ€
            </div>
            <button class="test-button" onclick="checkSystemStatus()">æ£€æŸ¥ç³»ç»ŸçŠ¶æ€</button>
            <button class="test-button" onclick="checkWebSocketConnection()">æ£€æŸ¥WebSocketè¿æ¥</button>
            <div class="test-result" id="systemStatusResult" style="display: none;"></div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8080/api';
        const FRONTEND_URL = 'http://localhost:8080';
        
        // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
        function showResult(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            const section = element.closest('.test-section');
            
            element.style.display = 'block';
            element.textContent = content;
            
            // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨
            const indicator = section.querySelector('.status-indicator');
            indicator.className = `status-indicator status-${type}`;
            
            // æ›´æ–°sectionæ ·å¼
            section.className = `test-section ${type}`;
        }

        // åˆ›å»ºæµ‹è¯•äº‹ä»¶
        async function createTestEvent() {
            try {
                showResult('eventResult', 'æ­£åœ¨åˆ›å»ºæµ‹è¯•äº‹ä»¶...', 'info');
                
                const eventData = {
                    id: `tc-realtime-test-${Date.now()}`,
                    title: 'å®æ—¶åŒæ­¥æµ‹è¯•äº‹ä»¶',
                    description: 'ç”¨äºæµ‹è¯•å®æ—¶åŒæ­¥åŠŸèƒ½çš„æµ‹è¯•äº‹ä»¶',
                    startDate: new Date().toISOString().split('T')[0],
                    endDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    startTime: '09:00',
                    endTime: '18:00',
                    timezone: 'Asia/Shanghai',
                    includeTime: true
                };

                const response = await fetch(`${API_BASE_URL}/events`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(eventData)
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();
                const eventUrl = `${FRONTEND_URL}/event/${result.id}`;
                
                document.getElementById('testEventLink').textContent = eventUrl;
                
                showResult('eventResult', 
                    `âœ… æµ‹è¯•äº‹ä»¶åˆ›å»ºæˆåŠŸï¼\n` +
                    `äº‹ä»¶ID: ${result.id}\n` +
                    `äº‹ä»¶é“¾æ¥: ${eventUrl}\n` +
                    `åˆ›å»ºæ—¶é—´: ${new Date().toLocaleString()}`, 
                    'success'
                );
                
            } catch (error) {
                showResult('eventResult', 
                    `âŒ åˆ›å»ºæµ‹è¯•äº‹ä»¶å¤±è´¥:\n${error.message}`, 
                    'error'
                );
            }
        }

        // æ‰“å¼€æµ‹è¯•äº‹ä»¶
        function openTestEvent() {
            const eventLink = document.getElementById('testEventLink').textContent;
            window.open(eventLink, '_blank');
            showResult('eventResult', 'å·²åœ¨æ–°çª—å£ä¸­æ‰“å¼€æµ‹è¯•äº‹ä»¶', 'info');
        }

        // æµ‹è¯•å®æ—¶åŒæ­¥
        async function testRealtimeSync() {
            showResult('realtimeSyncResult', 'å¼€å§‹å®æ—¶åŒæ­¥æµ‹è¯•...', 'info');
            
            const testSteps = [
                '1. æ£€æŸ¥WebSocketè¿æ¥çŠ¶æ€',
                '2. æ¨¡æ‹Ÿç”¨æˆ·é€‰æ‹©æ—¶é—´',
                '3. éªŒè¯çƒ­åŠ›å›¾å®æ—¶æ›´æ–°',
                '4. æ£€æŸ¥æ•°æ®ä¼ è¾“å»¶è¿Ÿ'
            ];
            
            let result = 'å®æ—¶åŒæ­¥æµ‹è¯•æ­¥éª¤:\n';
            
            for (let i = 0; i < testSteps.length; i++) {
                result += `${testSteps[i]}\n`;
                showResult('realtimeSyncResult', result + 'æ­£åœ¨æ‰§è¡Œ...', 'info');
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            
            result += '\nâœ… å®æ—¶åŒæ­¥æµ‹è¯•å®Œæˆ\n';
            result += 'è¯·åœ¨æµè§ˆå™¨ä¸­æ‰‹åŠ¨éªŒè¯ä»¥ä¸‹åŠŸèƒ½:\n';
            result += '- é€‰æ‹©æ—¶é—´æ—¶å³ä¾§çƒ­åŠ›å›¾ç«‹å³æ›´æ–°\n';
            result += '- å¤šä¸ªç”¨æˆ·çš„é€‰æ‹©èƒ½å¤Ÿå®æ—¶åŒæ­¥\n';
            result += '- æ•°æ®ä¼ è¾“å»¶è¿Ÿå°äº1ç§’';
            
            showResult('realtimeSyncResult', result, 'success');
        }

        // æ¨¡æ‹Ÿç”¨æˆ·é€‰æ‹©
        function simulateUserSelection() {
            showResult('realtimeSyncResult', 
                'è¯·åœ¨æµè§ˆå™¨ä¸­æ‰‹åŠ¨æ“ä½œ:\n' +
                '1. æ‰“å¼€æµ‹è¯•äº‹ä»¶é¡µé¢\n' +
                '2. è¾“å…¥ç”¨æˆ·åè¿›å…¥æˆ¿é—´\n' +
                '3. åœ¨å·¦ä¾§æ—¶é—´ç½‘æ ¼ä¸­é€‰æ‹©æ—¶é—´\n' +
                '4. è§‚å¯Ÿå³ä¾§çƒ­åŠ›å›¾æ˜¯å¦ç«‹å³æ›´æ–°\n' +
                '5. ä½¿ç”¨ä¸åŒæµè§ˆå™¨çª—å£æ¨¡æ‹Ÿå¤šç”¨æˆ·', 
                'info'
            );
        }

        // æµ‹è¯•æ•°æ®æ¢å¤
        async function testDataRecovery() {
            showResult('dataRecoveryResult', 'å¼€å§‹æ•°æ®æ¢å¤æµ‹è¯•...', 'info');
            
            const testInstructions = [
                '1. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æµ‹è¯•äº‹ä»¶',
                '2. è¾“å…¥ç”¨æˆ·åå¹¶é€‰æ‹©ä¸€äº›æ—¶é—´',
                '3. å…³é—­æµè§ˆå™¨æ ‡ç­¾é¡µ',
                '4. é‡æ–°æ‰“å¼€ç›¸åŒçš„äº‹ä»¶é“¾æ¥',
                '5. ä½¿ç”¨ç›¸åŒçš„ç”¨æˆ·åç™»å½•',
                '6. éªŒè¯å·¦ä¾§é€‰æ‹©çŠ¶æ€æ˜¯å¦æ­£ç¡®æ¢å¤',
                '7. éªŒè¯å³ä¾§çƒ­åŠ›å›¾æ•°æ®æ˜¯å¦ä¸€è‡´'
            ];
            
            let result = 'æ•°æ®æ¢å¤æµ‹è¯•æ­¥éª¤:\n';
            testInstructions.forEach((step, index) => {
                result += `${step}\n`;
            });
            
            result += '\né¢„æœŸç»“æœ:\n';
            result += '- å·¦ä¾§æ—¶é—´ç½‘æ ¼æ˜¾ç¤ºä¹‹å‰çš„é€‰æ‹©\n';
            result += '- å³ä¾§çƒ­åŠ›å›¾æ˜¾ç¤ºæ­£ç¡®çš„æ•°æ®\n';
            result += '- å‚ä¸è€…æ•°é‡æ˜¾ç¤ºæ­£ç¡®\n';
            result += '- æ²¡æœ‰æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µ';
            
            showResult('dataRecoveryResult', result, 'info');
        }

        // æ¨¡æ‹Ÿé¡µé¢é‡æ–°åŠ è½½
        function simulatePageReload() {
            showResult('dataRecoveryResult', 
                'é¡µé¢é‡æ–°åŠ è½½æµ‹è¯•:\n' +
                '1. ç¡®ä¿ä½ å·²ç»åœ¨æµ‹è¯•äº‹ä»¶ä¸­é€‰æ‹©äº†æ—¶é—´\n' +
                '2. æŒ‰F5æˆ–Ctrl+Råˆ·æ–°é¡µé¢\n' +
                '3. é‡æ–°è¾“å…¥ç”¨æˆ·å\n' +
                '4. æ£€æŸ¥æ•°æ®æ˜¯å¦æ­£ç¡®æ¢å¤', 
                'info'
            );
        }

        // æµ‹è¯•å¤šç”¨æˆ·åŒæ­¥
        async function testMultiUserSync() {
            showResult('multiUserResult', 'å¼€å§‹å¤šç”¨æˆ·åŒæ­¥æµ‹è¯•...', 'info');
            
            const result = 'å¤šç”¨æˆ·åŒæ­¥æµ‹è¯•è¯´æ˜:\n' +
                '1. æ‰“å¼€å¤šä¸ªæµè§ˆå™¨çª—å£æˆ–ä½¿ç”¨ä¸åŒè®¾å¤‡\n' +
                '2. åœ¨æ¯ä¸ªçª—å£ä¸­ä½¿ç”¨ä¸åŒçš„ç”¨æˆ·å\n' +
                '3. åŒæ—¶åœ¨ä¸åŒçª—å£ä¸­é€‰æ‹©æ—¶é—´\n' +
                '4. è§‚å¯Ÿå…¶ä»–çª—å£æ˜¯å¦å®æ—¶æ˜¾ç¤ºå˜åŒ–\n' +
                '5. éªŒè¯å‚ä¸è€…æ•°é‡æ˜¯å¦æ­£ç¡®\n' +
                '6. æ£€æŸ¥æ—¶é—´é‡å çš„çƒ­åŠ›å›¾æ˜¾ç¤º\n\n' +
                'é¢„æœŸç»“æœ:\n' +
                '- æ‰€æœ‰çª—å£æ˜¾ç¤ºä¸€è‡´çš„çƒ­åŠ›å›¾\n' +
                '- å‚ä¸è€…æ•°é‡å®æ—¶æ›´æ–°\n' +
                '- æ—¶é—´é‡å æ­£ç¡®æ˜¾ç¤º\n' +
                '- å»¶è¿Ÿå°äº2ç§’';
            
            showResult('multiUserResult', result, 'info');
        }

        // æ‰“å¼€å¤šä¸ªæµ‹è¯•çª—å£
        function openMultipleWindows() {
            const eventLink = document.getElementById('testEventLink').textContent;
            
            // æ‰“å¼€3ä¸ªæµ‹è¯•çª—å£
            for (let i = 1; i <= 3; i++) {
                setTimeout(() => {
                    window.open(eventLink, `_blank_${i}`);
                }, i * 500);
            }
            
            showResult('multiUserResult', 
                'å·²æ‰“å¼€3ä¸ªæµ‹è¯•çª—å£\n' +
                'è¯·åœ¨æ¯ä¸ªçª—å£ä¸­ä½¿ç”¨ä¸åŒçš„ç”¨æˆ·å:\n' +
                '- çª—å£1: ç”¨æˆ·A\n' +
                '- çª—å£2: ç”¨æˆ·B\n' +
                '- çª—å£3: ç”¨æˆ·C\n\n' +
                'ç„¶åå¼€å§‹é€‰æ‹©æ—¶é—´å¹¶è§‚å¯ŸåŒæ­¥æ•ˆæœ', 
                'info'
            );
        }

        // æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
        async function checkSystemStatus() {
            showResult('systemStatusResult', 'æ­£åœ¨æ£€æŸ¥ç³»ç»ŸçŠ¶æ€...', 'info');
            
            const checks = [
                { name: 'å‰ç«¯æœåŠ¡', url: FRONTEND_URL },
                { name: 'åç«¯API', url: `${API_BASE_URL}/health` },
                { name: 'äº‹ä»¶API', url: `${API_BASE_URL}/events` }
            ];
            
            let result = 'ç³»ç»ŸçŠ¶æ€æ£€æŸ¥:\n';
            
            for (const check of checks) {
                try {
                    const response = await fetch(check.url, { 
                        method: 'GET',
                        mode: 'cors'
                    });
                    
                    if (response.ok) {
                        result += `âœ… ${check.name}: æ­£å¸¸ (${response.status})\n`;
                    } else {
                        result += `âŒ ${check.name}: å¼‚å¸¸ (${response.status})\n`;
                    }
                } catch (error) {
                    result += `âŒ ${check.name}: è¿æ¥å¤±è´¥ (${error.message})\n`;
                }
            }
            
            showResult('systemStatusResult', result, 'info');
        }

        // æ£€æŸ¥WebSocketè¿æ¥
        async function checkWebSocketConnection() {
            showResult('systemStatusResult', 'æ­£åœ¨æ£€æŸ¥WebSocketè¿æ¥...', 'info');
            
            try {
                const wsUrl = API_BASE_URL.replace('http', 'ws');
                const ws = new WebSocket(wsUrl);
                
                ws.onopen = () => {
                    showResult('systemStatusResult', 
                        'âœ… WebSocketè¿æ¥æˆåŠŸ\n' +
                        `è¿æ¥åœ°å€: ${wsUrl}\n` +
                        'çŠ¶æ€: å·²è¿æ¥\n' +
                        'å®æ—¶åŒæ­¥åŠŸèƒ½åº”è¯¥æ­£å¸¸å·¥ä½œ', 
                        'success'
                    );
                    ws.close();
                };
                
                ws.onerror = (error) => {
                    showResult('systemStatusResult', 
                        'âŒ WebSocketè¿æ¥å¤±è´¥\n' +
                        `é”™è¯¯: ${error}\n` +
                        'å®æ—¶åŒæ­¥å¯èƒ½ä½¿ç”¨è½®è¯¢æ¨¡å¼', 
                        'warning'
                    );
                };
                
                // 5ç§’è¶…æ—¶
                setTimeout(() => {
                    if (ws.readyState === WebSocket.CONNECTING) {
                        ws.close();
                        showResult('systemStatusResult', 
                            'â° WebSocketè¿æ¥è¶…æ—¶\n' +
                            'å¯èƒ½æœåŠ¡å™¨ä¸æ”¯æŒWebSocket\n' +
                            'ç³»ç»Ÿå°†ä½¿ç”¨è½®è¯¢æ¨¡å¼', 
                            'warning'
                        );
                    }
                }, 5000);
                
            } catch (error) {
                showResult('systemStatusResult', 
                    `âŒ WebSocketæµ‹è¯•å¤±è´¥: ${error.message}`, 
                    'error'
                );
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
        window.addEventListener('load', () => {
            setTimeout(checkSystemStatus, 1000);
        });
    </script>
</body>
</html> 